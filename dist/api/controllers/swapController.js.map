{"version":3,"file":"swapController.js","names":["newSwap","req","res","meta","body","response","db","swaps","create","metadata","JSON","stringify","status","init_address","init","address","accept_address","accept","json","success","message","data","err","console","log","updateSwap","update","where","getPending","findAll","Op","and","or","history","sendSign","init_sign","sign","swapController"],"sources":["../../../src/api/controllers/swapController.js"],"sourcesContent":["import db from \"../../database/models\"\r\nimport { Op } from \"sequelize\"\r\n\r\nconst newSwap = async (req, res) => {\r\n    try {\r\n        var meta = req.body.meta;\r\n        \r\n        const response = await db.swaps.create({\r\n            metadata: JSON.stringify(meta),\r\n            status: 1,\r\n            init_address: meta.init.address,\r\n            accept_address: meta.accept.address\r\n        })\r\n        if (response) {\r\n            res.json({\r\n                success: true,\r\n                message: \"new_swap\",\r\n                data: response\r\n            })\r\n        }\r\n    } catch (err) {\r\n        console.log(err)\r\n        res.status(500).json({\r\n            success: false,\r\n            message: \"***new_swap error\"\r\n        })\r\n    }\r\n}\r\n\r\nconst updateSwap = async (req, res) => {\r\n    try {\r\n        const response = await db.swaps.update(\r\n            { status: req.body.status },\r\n            { where: { metadata: req.body.meta } }\r\n        )\r\n        if (response) {\r\n            res.json({\r\n                success: true,\r\n                message: \"update_swap\",\r\n                data: response\r\n            })\r\n        }\r\n    } catch (err) {\r\n        console.log(err)\r\n        res.status(500).json({\r\n            success: false,\r\n            message: `***update_swap error`\r\n        })\r\n    }\r\n}\r\n\r\nconst getPending = async (req, res) => {\r\n    try {\r\n        const response = await db.swaps.findAll({\r\n            where: {\r\n                [Op.and]: {\r\n                    status: 1,\r\n                    [Op.or]: [\r\n                        { accept_address: req.body.address },\r\n                        { init_address: req.body.address }\r\n                    ]\r\n                }\r\n            }\r\n        })\r\n        if (response) {\r\n            res.json({\r\n                success: true,\r\n                message: \"get_pending\",\r\n                data: response\r\n            })\r\n        }\r\n    } catch (err) {\r\n        console.log(err)\r\n        res.status(500).json({\r\n            success: false,\r\n            message: `***get_pending error`\r\n        })\r\n    }\r\n}\r\n\r\nconst history = async (req, res) => {\r\n    try {\r\n        const response = await db.swaps.findAll({\r\n            //attributes: [\"createdAt\", \"status\"],\r\n            where: {\r\n                [Op.or]: [\r\n                    { accept_address: req.body.address },\r\n                    { init_address: req.body.address }\r\n                ]\r\n            }\r\n        })\r\n        if (response) {\r\n            res.json({\r\n                success: true,\r\n                message: \"history\",\r\n                data: response\r\n            })\r\n        }\r\n    } catch (err) {\r\n        console.log(err)\r\n        res.status(500).json({\r\n            success: false,\r\n            message: `***history error`\r\n        })\r\n    }\r\n}\r\n\r\nconst sendSign = async (req, res) => {\r\n    try {\r\n        const response = await db.swaps.update(\r\n            { init_sign: req.body.sign },\r\n            { where: { init_address: req.body.address } }\r\n        )\r\n        if (response) {\r\n            res.json({\r\n                success: true,\r\n                message: \"send_sign\",\r\n                data: response\r\n            })\r\n        }\r\n    } catch (err) {\r\n        console.log(err)\r\n        res.status(500).json({\r\n            success: false,\r\n            message: `***send_sign error`\r\n        })\r\n    }\r\n}\r\n\r\nexport const swapController = {\r\n    updateSwap,\r\n    newSwap,\r\n    getPending,\r\n    history,\r\n    sendSign\r\n}\r\n"],"mappings":"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"}